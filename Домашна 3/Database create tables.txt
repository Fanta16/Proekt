DROP TABLE IF EXISTS ACCOUNTS;
DROP TABLE IF EXISTS PRODUCTS;
DROP TABLE IF EXTSTS ORDERS;
DROP TABLE IF EXISTS ORDER_DETAILS
-- Create table
create table ACCOUNTS
(
  USER_NAME VARCHAR(20) not null PRIMARY KEY,
  ACTIVE    BOOLEAN not null,
  ENCRYTED_PASSWORD  VARCHAR(128) not null,
  USER_ROLE VARCHAR(20) not null
) ;

---------------------------------------
 
create table PRODUCTS
(
  CODE        VARCHAR(20) not null PRIMARY KEY,
  IMAGE       bytea,
  NAME        VARCHAR(255) not null,
  PRICE       double precision not null,
  CREATE_DATE Timestamp without time zone not null
) ;

---------------------------------------
-- Create table
create table ORDERS
(
  ID               VARCHAR(50) not null PRIMARY KEY,
  AMOUNT           double precision not null,
  CUSTOMER_ADDRESS VARCHAR(255) not null,
  CUSTOMER_EMAIL   VARCHAR(128) not null,
  CUSTOMER_NAME    VARCHAR(255) not null,
  CUSTOMER_PHONE   VARCHAR(128) not null,
  ORDER_DATE       Timestamp without time zone not null,
  ORDER_NUM        INT not null,
	CONSTRAINT ORDER_UK UNIQUE (ORDER_NUM)
) ;
---------------------------------------
 
-- Create table
create table ORDER_DETAILS
(
  ID         VARCHAR(50) not null PRIMARY KEY,
  AMOUNT     double precision not null,
  PRICE      double precision not null,
  QUANITY    INT not null,
  ORDER_ID   VARCHAR(50) not null,
  PRODUCT_ID VARCHAR(20) not null,
	CONSTRAINT ORDER_DETAIL_ORD_FK FOREIGN KEY (ORDER_ID) REFERENCES ORDERS (ID),
	CONSTRAINT ORDER_DETAIL_PROD_FK FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS (CODE)
) ;
---------------------------------------  
insert into Accounts (USER_NAME, ACTIVE, ENCRYTED_PASSWORD, USER_ROLE)
values ('user1', true,
'$2a$10$PrI5Gk9L.tSZiW9FXhTS8O8Mz9E97k2FZbFvGFFaSsiTUIl.TCrFu', 'ROLE_USER');
 
insert into Accounts (USER_NAME, ACTIVE, ENCRYTED_PASSWORD, USER_ROLE)
values ('manager1', true,
'$2a$10$PrI5Gk9L.tSZiW9FXhTS8O8Mz9E97k2FZbFvGFFaSsiTUIl.TCrFu', 'ROLE_MANAGER');
 
----------------
insert into products (CODE, NAME, PRICE, CREATE_DATE)
values ('S001', 'Core Java', 100, current_timestamp);
 
insert into products (CODE, NAME, PRICE, CREATE_DATE)
values ('S002', 'Spring for Beginners', 50, current_timestamp);
 
insert into products (CODE, NAME, PRICE, CREATE_DATE)
values ('S003', 'Swift for Beginners', 120, current_timestamp);
 
insert into products (CODE, NAME, PRICE, CREATE_DATE)
values ('S004', 'Oracle XML Parser', 120, current_timestamp);
 
insert into products (CODE, NAME, PRICE, CREATE_DATE)
values ('S005', 'CSharp Tutorial for Beginers', 110, current_timestamp);